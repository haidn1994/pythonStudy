# 통계값을 이용한 데이터 설명

3장에서는 파이썬을 이용해 통계를 살펴본다.  
이를 통해 데이터 집합에 대한 학습 및 설명은 물론 이해도를 높일 수 있도록 한다.  
몇 가지 기본 통계 측정값(중심 성향)에 해당하는 평균(mean), 중위수(median), 범위(range)를 살펴본 후  
고급 측정값(산포 경향)에 해당하는 분산과 표준편차를 알아본다.  
참고로 통계학에서는 몇몇 대표값은 모집합 데이터인가 아니면 표본인가에 따라 약간씩 차이가 있다.  
3장에서는 모집단에 대한 계산 방법으로 설명한다.  

다음으로 두 데이터 집합 간의 관계를 정량화할 수 있는 상관계수를 계산하는 방법을 살펴본다.  
3장 후반부에서는 산점도에 대해 알아볼 것이다. 이 방법과 함께 파이썬 언어와 표준라이브러리 모듈에 대해서도 알아본다.  
가장 일반적으로 사용하는 통계값 중 하나인 평균(mean)부터 시작하자.  

## 평균 계산

평균은 숫자 집합을 요약하는 일반적이고 직관적인 방법이다. 'average'에는 다른 종류의 평균이 존재하지만 일반적인 사용으로  
평균(mean)을 'average'라고 부른다. 표본숫자 집합을 취해 평균을 계산해보자. 


지난 12일(이 기간을 A라고 하자.)동안 기부금을 받는 학교 자선행사가 있다고 하자.  
이 기간에 다음 12개 숫자는 해당 일자에 벌어들인 기부 금액의 총액(달러)이다.  

> 100, 60, 70, 900, 100, 200, 500, 500, 503, 600, 1000, 1200


총 합을 구한 다은 기간(일)의 합으로 나누어 평균을 계산한다.  
이 경우 기부금 숫자의 합은 5733이다. 만약 5733을 기간 12로 나누면 477.75가 되며,  
이 값은 일별 평균 기부액이 된다. 이 값은 특정일에 얼마나 많은 금액이 기부되었는가에 대한 일반적인 생각이다.


이제 우리는 숫자 집합에 대해 평균을 계산하고 출력하는 프로그램을 작성할 수 있다.  
앞에서 보았던 것처럼 평균을 계산하려면 숫자 리스트의 합을 취한 다음 이 값을 리스트 내의 아이템의 수로 나누어야 한다.  
이러한 작업을 매우 쉽게 해주는 두 개의 파이썬 함수로 sum()과 len()을 사용하면 된다.  
이제 donations리스트의 평균을 계산하는 프로그램을 작성할 준비가 되어 있다.  

```{.py}
# 이 평균은 산술평균(arithmetic mean)이다.
def calculate_mean(numbers)
	s = sum(numbers)
	N = len(numbers)
	# 평균계산
	mean = s/N

	retrun mean
if __name__ == '__main__':
	donations = [100, 60, 70, 900, 100, 200, 500, 500, 503, 600, 1000, 1200]
	mean = calculate_mean(donations)
	N = len(donations)
	print('Mean donation over the last {0} days is  {1}'.format(N, mean))
```
가장 먼저 숫자 리스트인 numbers를 인자로 하는 함수 calculate\_mean()을 정의하자.  

1. sum()을 이용해서 리스트 내의 숫자를 더하고 총합을 저장할 레이블 s를 만든다.  
2. len()을 이용해서 리스트의 길이를 계산하고 이 값을 저장할 레이블 N을 만든다.
3. 다음으로 3에서와 같이 총합(S)을 구성원의 개수(N)으로 나누어 평균을 계산한다.
4. 기부액을 값으로 갖는 리스트 donations를 만든다.
5. 한 개인자로 리스트 타입을 갖는 calculate\_mean()을 호출한다.
6. 계산된 평균을 format()을 이용해서 출력한다.

일별 평균 기부금은 477.75다. 처음 며칠 동안은 기부금이 평균금액보다 작고 
마지막 이틀 동안의 기부액이 매우 높은 것은 큰 의미가 없다. 평균값은 데이터를 요약하는 매우 좋고 중요한 한 가지 방법이다.  
하지만 데이터에 대한 **모든 정보**를 제공하지는 않는다. 이제 다른 통계측정량(다른 중심 성향)에 대해서 알아보자.  

## 중위수(median) 계산

숫자 집합에 대한 중위수는 또 다른 종류의 평균(average)이다. 중위수를 계산하려면 오름차순으로 숫자를 정렬해야 한다.  
리스트 내 숫자의 개수가 홀수이면, 리스트의 중간에 위치한 숫자가 중위수다. 리스트 내 숫자의 개수가 짝수이면  
중간에 위치한 숫자 두 개의 평균을 계산해 중위수를 계산한다. 앞에서 사용한 donations list의 중위수를 계산해보자.  


숫자 리스트의 중위수를 계산하는 프로그램을 작성하기 전에 다른 경우에 해당하는 리스트의 중간값을 자동으로 계산하는 방법에 대해 생각해보자.  
리스트(N)의 길이가 홀수이면 중위수는 (N+1)/2의 위치에 있는 값이다. N이 짝수이면 두개의 중간요소는 N/2와 (N/2)+1이 된다.  
중위수를 계산하는 함수를 작성하려면 리스트를 오름차순으로 정렬해야 한다. sort()가 이 기능을 수행한다.
(참고: sort()어떤 값을 반환하는 것이아니라 sort()의 인자로 들어간 컨테이너의 상태를 바꾼다는 점을 유의하라)  
이제 숫자 리스트의 중위수를 계산하는 다음 프로그램을 작성할 수 있다.  

```{.py}
# 중위수 계산하기

def calculate_median(numbers):
	N = len(numbers)
	numbers.sort()

	# 중위수 계산하기
	if N%2 == 0:
		m1 = N/2
		m2 = (N/2) + 1
	# 정수로 변환하여, 위치를 찾는다.(주의점: 캐스팅 관례를 알고 있어야 함)
		m1 = int(m1) - 1
		m2 = int(m2) - 1
		median = (numbers[m1] + numbers[m2])/2
	else:
		m = (N + 1)/2
		m = int(m) - 1
		median = numbers[m]
	return median

if __name__ == '__main__':
	donations = [100, 60, 70, 900, 100, 200, 500, 500, 503, 600, 1000, 1200]
	median = calculate_mean(donations)
	N = len(donations)
	print('Median donation over the last {0} days is  {1}'.format(N, median))

```

프로그램의 전체 구조는 평균을 계산한 초기 프로그램의 구조와 유사하다.  
calculate_median()은 숫자 리스트를 입력받은 다음 중위값을 반환받는다.  

1. 리스트의 길이를 계산하고 값을 참고하기 위한 레이블(N)을 생성한다.  
2. 다음으로 sort()를 이용해서 리스트를 정렬한다.  
3. 다음으로 N이 짝수인지 여부를 확인한다. 짝수라면 N/2과 (N/2)+1에 위치하는 m1과 m2를 가지고 중위값을 계산한다.  
	* 홀수이면 (N/2)+1번째 항목을 중위값으로 정한다.
4. 첫번째 int()를 이용해서 해당 값 m1과 m2를 정수 형태로 변환한다. 이는 결과가 정수이더라도 나누기 연산자의 결과는  
	* 항상 부동소수점 숫자로 리턴되어야 하기 때문이다.  

여러 과정을 거쳐서 실행하면 다음과 같은 결과를 얻는다.  

> Median donation over the last 12 days is 500.0


알다시피 평균(477.75)과 중위수(500)는 리스트 내 꽤 근접한 값이지만 중위수가 약간 높다.  


## 최빈수를 계산하고 빈도 테이블 생성

평균값이나 중위수를 알아내는 대신, 가장 자주 발생한 숫자를 알아내기 원한다면 무엇을 해야 하는가?  
이 숫자는 최빈값(mode)이라고 한다. 예를 들어 리스트의 최빈수는 어떤 점수가 리스트 내에서 가장 빈번하게 발생했는가를 보여줄 것이다.  
최빈수를 계산하는 대표공식은 없다. 
단순히 특정 숫자가 얼마나 많이 발생하는지 카운트하고 가장 빈번한 숫자를 알아내는 것이 최빈수를 알아내는 방법이다.  


최빈수를 계산하는 프로그램을 작성하려면 파이썬이 리스트 내의 각 숫자의 발생 빈도를 계산해 가장 빈발하는 숫자를 출력하도록 해야 한다.  
collections 모듈의 Counter클래스는 표준 라이브러리이며 실제로 사용하기에 간단하다.  


## 가장 공통적인 요소 알아내기

```{.py}
```
```{.py}
```


## 최빈값 찾기

숫자 리스트에 대한 최빈값(mode)을 계산하는 프로그램을 작성할 수 있다.  
```{.py}
# 최빈값 계산
from collections import Counter

def calculate_mode(numbers):
	c = Counter(numbers)
	mode = c.most_common(1)
	return mode[0][0]

if __name__ == '__main__':
	scores = [7, 8, 9, 2, 10, 9, 9, 9, 9, 4, 5, 6, 1, 5, 6, 7, 8, 1, 10]
	mode = calculate_mode(scores)
	print('The mode of the list of numbers is: {0}'.format(mode))
```

이 코드는 그럭저럭 잘 동작한다.  
하지만 두 개 이상의 숫자와 빈발 횟수가 같은 경우는 어떻게 해야 하는가?  
이러한 경우 숫자 리스트는 여러 숫자를 최대 빈발 숫자로 갖는다.  
따라서 모든 빈발 숫자를 계산하는 프로그램을 개발해야 한다. 이를 위해 변경된 프로그램은 다음과 같다.  

```{.py}
# 여러 최빈값을 갖는 숫자 리스트를 대상으로 최빈값 계산하기
from collections import Counter

def calculate_mode(numbers):
	c = Counter(numbers)
	numbers_freq = c.most_common()
	max_count = number_freq[0][1]

	mode = []
	for num in numbers_freq:
		if num[1] == max_count:
			modes.append(num[0])
	return modes

if __name__ == '__main__':
	scores = [5, 5, 5, 4, 4, 4, 9, 1, 3]
	modes = calculate_mode(scores)
	print('The mode(s) of the list of numbers are:')
	for mode in modes:
		print(mode)
```
최빈값 대신 모든 숫자의 빈도를 알아내려고 한다면 어떻게 해야 하는가?  
개별 빈도 테이블은 명칭과 같이 숫자가 숫자 집합 내에서 발생한 횟수를 보여주는 테이블이다.  

## 빈도 테이블 생성
다음 테스트 점수 리스트를 다시 생각해보자.  


```{.py}
```

## 산포정도 측정
다음에 살펴볼 통계 계산 값은 산포를 측정해 데이터 집합 내의 숫자가 어느 정도 평균에서 떨어져 있는지를 알아낸다.  
산포를 측정하는 3가지 값으로 범위(range), 분산(variance), 표준편차(standard deviation)를 알아보겠다.  

### 숫자 집합의 범위 알아내기
위에서 봤던 기부금 리스트의 평균은 477.75였다.  
하지만 평균만을 보면 모든 기부금이 좁은 범위 내(예를 들면 400과 500사이)에 위치하는지를 알지 못한다.  
또한 그 이상으로 넓은 범위 내(예를 들어 60과 1200 사이)위치하는지를 모른다. 범위는 숫자 리스트에 대해  
가장 큰 수와 작은 수 간의 차이가 된다. 여러분은 평균은 동일하지만 범위는 상당히 다른 숫자 그룹을 갖고 있어  
평균, 중위수, 최빈수를 보는 것으로부터 알아낼 수 있는 것 이상의 정보를 제공한다는 것을 알 수 있다.  


다음은 앞에서 설명한 기부금 리스트의 범위를 계산하는 프로그램이다. 

```{.py}
# 범위 알아내기

def find_range(numbers):
	lo = min(numbers)
	hi = max(numbers)
	# find the range
	r = hi - lo
	return lo, hi, r

if __name__ == '__main__':
	donations = [100, 60, 70, 900, 100, 200, 500, 500, 503, 600, 1000, 1200]
	lo, hi, r = find_range(donations)
	print('Lowest: {0} Highest: {1} Range: {2}'.format(lowest, higher, r))
```
find\_range()는 리스트에 대한 범위를 계산한다.  

1. 우선 1과 2에서 min()과 max()를 사용해 최소값과 최대값을 계산한다.  
2. 그리고 파이를 의미하는 레이블 r을 이용해 가능성이 높은 숫자와 낮은 숫자 간 차이를 취해 범위를 계산한다.  
3. 함수로 부터 3개의 숫자를 리턴한다.(최저값, 최고값, 범위)  

결과를 살펴보면 lo: 60, hi: 1200, range: 1140으로, 하루의 총 기부액은 꽤 많은 영역에 퍼져 있음을 알 수 있다.  

### 분산과 표준편차 계산

범위는 숫자 집합에 있는 두 개의 극단값 간의 차이를 계산한다.  
하지만 평균에서 모든 개별 숫자가 변동하는 정도에 대해 좀 더 많이 알고 싶다면 어떻게 해야 하는가?  
숫자들이 모두 유사하고 평균 근처에 모여 있는지 아니면 모두 차이가 커서 양극단치에 가깝게 쏠려있는가?  
숫자 리스트에 대해 더 많은 정보를 알려주는 두 가지 산포 관련 측정값은 분산(Variance)과 표준편차(standard deviation)다.  


이 값 중에 한 개를 계산하려면, 각 숫자와 평균 간의 차이를 계산한다. 분산은 차이의 제곱을 평균한 값이다.  
분산값이 크면, 각 관측값들이 평균에서 멀리 떨어져 있음을 의미한다.  
분산값이 작다면, 각 관측값들이 평균에 가깝게 뭉쳐 있음을 의미한다. 분산은 다음 공식을 이용해 계산한다.  

> var(x) = sigma(x\_i - x\_mean)^2 / n


공식에서 x\_i는 개별 값을 의미하고 x\_mean은 이 숫자들의 평균을 의미한다. 그리고 n은 리스트 항목의 개수다.  
즉, 리스트 내 각 값에 대해 해당 숫자와 평균 간 차이를 취해 이 값을 제곱한다.  
다음으로 모든 제곱 차이를 더하고 이 값을 n으로 나누면 분산이 된다.


만약 표준편차도 구하고 싶다면 분산을 구한다음 그 제곱근을 구하면 된다.  
평균의 표준편차 내에 있는 값은 꽤 일반적이다. 
하지만 평균으로부터 3개 이상의 표준편차의 값만큼 떨어진 값은 비정상 또는 이상치(outliers)라고 한다.  


산포에 대한 두 측정값인 분산과 표준편차를 갖는 이유는 무엇일까? 간단히 두 개의 측정값은 여러 상황에서 유용하다.  
분산을 계산하기 위해 사용한 공식으로 되돌아가서 여러분은 평균으로부터 차이의 제곱에 평균이므로  
**제곱 단위로 표현**된다는 것을 알 수 있다. 다른 측면에서 생각해보면 표준편차는 모집단 데이터와 같은 단위로 표현해야 한다.  
예를 들어 기부금 리스트(물리의 모멘트에서 수행한 것처럼)에 대한 결과는 이해아기 어려운 제곱달러로 표시해야 한다.  
이와는 달리 표준편차는 기부금과 같은 단위인 달러로 표시할 수 있다.  



## 두 데이터 집합 간 상관관계 계산

이 절에서는 두 숫자 집합 간 관계의 특성과 강도를 알려주는 통계측정값(피어슨 (적률)상관계수)을 계산하는 방법에 대해 알아보겠다.  
피어슨 상관계수는 간단히 상관계수라고도 한다. 이 값은 선형 관계의 강도를 측정한다.  
두 데이터 집합이 비선형 관계에 있을 때 상관 계수를 알아내기 위해서는 다른 측정값을 이용해야 한다.  
상관계수는 양의 값 또는 음의 값을 가지며 -1이상과 1이하 사이의 범위를 갖는다.  


상관계수가 0이면 두 데이터 간에 선형관계가 전혀 없음을 의미한다.  
(이 값은 두 값이 서로 독립임을 의미하지는 않는다. 예를 들어 두 값 사이에는 비선형 관계가 있을 수 있다. )  
상관계수가 1이거나 1에 가까우면 매우 강한 양의 선형 관계가 있음을 의미한다.  
정확히 상관계수가 1이면 완전한 양의 상관관계이다. 
유사하게 상관계수가 -1이거나 -1에 가까우면 강한 음의 상관관계가 있음을 나타내며 -1은 완벽한 음의 상관관계다.  

### 상관관계와 우연성


### 상관계수 계산

이제 상관계수를 계산하는 프로그램을 살펴보자.  

```{.py}
def find_corr_x_y(x, y):
	n = len(x)

	# 곱의 합을 계산하기
	prod = []
	for xi, yi in zip(x, y):
		prod.append(xi*yi)
	sum_prod_x_y = sum(prod)
	sum_x = sum(x)
	sum_y = sum(y)
	squared_sum_x = sum_x**2
	squared_sum_y = sum_y**2
	
	x_square = []
	for xi in x:
		x_square.append(xi**2)
	# 합 계산
	x_square_sum = sum(x_square)
	y_square = []
	for yi in y:
		y_square.append(yi**2)
	# 합 계산
	y_square_sum = sum(y_square)

	# 이제 상관계수를 사용하는 공식을 사용한다.  
	numerator = n*sum_prod_x_y - sum_x*sum_y
	denominator_term1 = n*x_square_sum - squared_sum_x
	denominator_term2 = n*y_square_sum - squared_sum_y
	denominator = (denominator_term1*denominator_term2)**0.5
	correlation = numerator/denominator

	return correlation
```

### 고등학교 성적 등급과 대학 입학시험 성적

## 산점도

앞의 절에서는 처음으로 산점도가 두 숫자 집합 간 상관관계의 존재가 있음을 알려주고 있다.  
이 절에는 4개의 데이터 집합을 살펴보고 산점도 분석의 중요도에 대해 알아보겠다.  
이 데이터 셋에 대해 기존의 통계측정값은 모두 동일하다.  
하지만 각 데이터 집합의 산점도는 중요한 차이를 보여준다. 우선 파이썬에서 산점도를 만드는 방법을 살펴보자.  

